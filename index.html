<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OE3LCR Ham Radio Dashboard ‚Äì Live Solar Data, Band Conditions, DX Cluster, Satelliten-Tracking und Weltraumwetter f√ºr Amateurfunker.">
    <title>OE3LCR - Ham Radio Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 200 200'%3E%3Crect width='200' height='200' fill='%23f5f5f5'/%3E%3Cdefs%3E%3Cfilter id='glow'%3E%3CfeGaussianBlur stdDeviation='2' result='coloredBlur'/%3E%3CfeMerge%3E%3CfeMergeNode in='coloredBlur'/%3E%3CfeMergeNode in='SourceGraphic'/%3E%3C/feMerge%3E%3C/filter%3E%3C/defs%3E%3Ccircle cx='100' cy='100' r='70' fill='none' stroke='%2300bb77' stroke-width='1.5' opacity='0.4' filter='url(%23glow)'/%3E%3Crect x='85' y='50' width='30' height='20' fill='%2300ff88' rx='3' filter='url(%23glow)'/%3E%3Crect x='55' y='65' width='25' height='10' fill='%2300cc66' rx='2' filter='url(%23glow)'/%3E%3Crect x='120' y='65' width='25' height='10' fill='%2300cc66' rx='2' filter='url(%23glow)'/%3E%3Cline x1='100' y1='50' x2='100' y2='25' stroke='%2300ff88' stroke-width='2' stroke-linecap='round' filter='url(%23glow)'/%3E%3Ccircle cx='100' cy='50' r='3' fill='%2300ff88' filter='url(%23glow)'/%3E%3C/svg%3E">
    <script src="/satellite.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; font-variant-numeric: tabular-nums; background: linear-gradient(135deg, #0a0a0f 0%, #1a1a2e 50%, #0f0f1a 100%); color: #e0e0e0; min-height: 100vh; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { display: flex; justify-content: space-between; align-items: center; padding: 20px; margin-bottom: 20px; background: rgba(20,20,35,0.8); border-radius: 15px; border: 1px solid rgba(0,255,136,0.2); }
        .callsign { font-family: 'Orbitron', sans-serif; font-size: 2.5em; font-weight: 700; color: #00ff88; text-shadow: 0 0 20px rgba(0,255,136,0.5); }
        .time { font-family: 'Inter', sans-serif; font-weight: 700; font-size: 2.5em; color: #ff6b35; text-shadow: 0 0 15px rgba(255,107,53,0.5); letter-spacing: 0.05em; font-variant-numeric: tabular-nums; }
        .date { font-size: 1.2em; color: #888; }
        .main-content { display: grid; grid-template-columns: 2fr 1fr; gap: 20px; margin-bottom: 20px; }
        .sun-display { background: rgba(20,20,35,0.9); border-radius: 15px; padding: 30px; border: 2px solid rgba(255,165,2,0.3); box-shadow: 0 8px 32px rgba(0,0,0,0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .sun-container { width: 450px; height: 450px; margin: 15px 0; border-radius: 50%; overflow: hidden; }
        .sun-image { width: 100%; height: 100%; box-shadow: 0 0 80px rgba(255,165,2,0.6); object-fit: cover; }
        .dashboard { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        .card { background: rgba(20,20,35,0.9); border-radius: 15px; padding: 20px; border: 1px solid rgba(255,255,255,0.1); box-shadow: 0 8px 32px rgba(0,0,0,0.3); }
        .card-header { display: flex; align-items: center; gap: 10px; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 1px solid rgba(255,255,255,0.1); }
        .card-header .icon { font-size: 1.2em; }
        .card-title { font-size: 0.9em; text-transform: uppercase; letter-spacing: 2px; color: #ff4757; font-weight: 600; }
        .location .grid-square { font-family: 'Inter', sans-serif; font-size: 2em; color: #00d4ff; margin-bottom: 10px; font-weight: 700; letter-spacing: 0.1em; }
        .location .coords { color: #888; font-size: 1em; margin-bottom: 10px; }
        .location .celestial-times { display: grid; gap: 8px; margin-top: 10px; }
        .location .celestial-row { display: flex; justify-content: space-between; padding: 8px 12px; background: rgba(255,255,255,0.03); border-radius: 8px; }
        .location .sun-row { color: #ffa502; }
        .location .moon-row { color: #a8dadc; }
        .location .celestial-label { font-size: 0.9em; font-weight: 600; }
        .location .celestial-times-text { font-size: 0.95em; font-variant-numeric: tabular-nums; }
        .location .moon-phase { font-size: 1.2em; margin-right: 8px; }
        .info-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px; }
        .info-box { padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; border: 1px solid rgba(255,255,255,0.1); }
        .info-label { font-size: 0.8em; color: #666; text-transform: uppercase; }
        .info-value { font-size: 1.2em; color: #e0e0e0; margin-top: 5px; font-weight: 600; }
        @media (max-width: 1000px) { .main-content { grid-template-columns: 1fr; } }

        /* COMPACT Band Conditions */
        .band-conditions-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 5px; margin-top: 15px; }
        .band-box { padding: 6px 3px; border-radius: 8px; text-align: center; font-weight: 700; border: 1.5px solid; transition: all 0.3s; cursor: pointer; }
        .band-box:hover { transform: translateY(-2px); }
        .band-box.good { background: rgba(0,255,100,0.08); border-color: #00ff64; color: #00ff88; box-shadow: 0 0 8px rgba(0,255,136,0.3); }
        .band-box.fair { background: rgba(255,165,0,0.08); border-color: #ffa502; color: #ffb020; box-shadow: 0 0 8px rgba(255,165,2,0.3); }
        .band-box.poor { background: rgba(255,100,130,0.08); border-color: #ff6482; color: #ff7b9c; box-shadow: 0 0 8px rgba(255,100,130,0.3); }
        .band-name { font-size: 0.85em; font-weight: 800; margin-bottom: 1px; text-transform: uppercase; letter-spacing: 0.5px; }
        .band-condition { font-size: 0.55em; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 600; opacity: 0.9; }

        .metric-bar-bg { height: 8px; border-radius: 4px; overflow: hidden; }
        .metric-bar { height: 100%; width: 0%; transition: width 0.3s ease; }
        .demo-badge { display: inline-block; background: rgba(0,255,136,0.2); color: #00ff88; font-size: 0.65em; padding: 2px 6px; border-radius: 4px; margin-left: 8px; font-weight: 600; }
        .footer { text-align: center; margin-top: 30px; color: #666; font-size: 0.9em; }

        /* Setup Modal */
        #setup-modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .modal-content { background: rgba(20,20,35,0.95); border: 2px solid rgba(0,255,136,0.3); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 40px rgba(0,255,136,0.2); }
        .modal-header { font-size: 1.8em; font-weight: 700; color: #00ff88; margin-bottom: 10px; text-align: center; }
        .modal-subtitle { color: #aaa; text-align: center; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; color: #00ff88; font-weight: 600; font-size: 0.95em; }
        .form-group input, .form-group select { width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid rgba(0,255,136,0.3); border-radius: 8px; color: #e0e0e0; font-size: 1em; font-family: 'Inter', sans-serif; transition: all 0.3s; }
        .form-group input:focus, .form-group select:focus { outline: none; border-color: #00ff88; background: rgba(0,255,136,0.1); box-shadow: 0 0 20px rgba(0,255,136,0.2); }
        .modal-buttons { display: flex; gap: 15px; margin-top: 30px; }
        .btn-primary { flex: 1; padding: 12px 20px; background: linear-gradient(135deg, #00ff88, #00cc6a); color: #000; border: none; border-radius: 8px; font-weight: 700; font-size: 1em; cursor: pointer; transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,255,136,0.4); }

        /* Settings Modal (dynamically created by user-settings.js) */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 9999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(5px); }
        .settings-modal-content { background: rgba(20,20,35,0.95); border: 2px solid rgba(255,165,2,0.3); border-radius: 20px; padding: 40px; max-width: 500px; width: 90%; box-shadow: 0 20px 60px rgba(0,0,0,0.8), 0 0 40px rgba(255,165,2,0.2); }
        .settings-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; }
        .settings-header h2 { color: #ffa502; font-size: 1.5em; margin: 0; }
        .close-btn { background: none; border: none; color: #ffa502; font-size: 2em; cursor: pointer; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
        .close-btn:hover { color: #ffb733; }
        .settings-info { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #ccc; }
        .settings-info p { margin: 5px 0; font-size: 0.95em; }
        .settings-buttons { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        .btn-save { padding: 10px; background: linear-gradient(135deg, #00ff88, #00cc6a); color: #000; border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-save:hover { transform: translateY(-2px); box-shadow: 0 8px 20px rgba(0,255,136,0.3); }
        .btn-reset { padding: 10px; background: rgba(255,71,87,0.2); color: #ff4757; border: 1px solid #ff4757; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .btn-reset:hover { background: rgba(255,71,87,0.3); }
        .btn-cancel { padding: 10px; background: rgba(255,255,255,0.1); color: #aaa; border: 1px solid rgba(255,255,255,0.2); border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s; grid-column: 1 / -1; }
        .btn-cancel:hover { background: rgba(255,255,255,0.15); }
        #settings-btn { background: rgba(255,165,2,0.2); border: 1px solid rgba(255,165,2,0.4); color: #ffa502; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s; font-size: 0.9em; }
        #settings-btn:hover { background: rgba(255,165,2,0.3); box-shadow: 0 0 20px rgba(255,165,2,0.2); }
        #kiosk-btn { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 10px 18px; border-radius: 8px; font-weight: 600; cursor: pointer; font-size: 0.9em; transition: all 0.3s; box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3); }
        #kiosk-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(102, 126, 234, 0.5); }
        body.kiosk-mode { overflow: hidden; }
        body.kiosk-mode.view-top .bottom-section { display: none; }
        body.kiosk-mode.view-bottom .top-section { display: none; }
        .top-section, .bottom-section { transition: opacity 0.5s ease-in-out; }

        @media (max-width: 1200px) { .band-conditions-grid { grid-template-columns: repeat(5, 1fr); } }
        @media (max-width: 900px) { .band-conditions-grid { grid-template-columns: repeat(4, 1fr); } }
        @media (max-width: 768px) { .modal-content, .settings-modal-content { padding: 30px 20px; max-width: 90vw; } .modal-header { font-size: 1.4em; } .form-group input, .form-group select { padding: 14px; font-size: 16px; } .modal-buttons { flex-direction: column; } #settings-btn { padding: 10px 12px; font-size: 0.85em; } .band-conditions-grid { grid-template-columns: repeat(4, 1fr); gap: 4px; } }
        @media (max-width: 480px) { .band-conditions-grid { grid-template-columns: repeat(3, 1fr); gap: 3px; } .band-name { font-size: 0.75em; } .band-condition { font-size: 0.5em; } }
    
        /* Kiosk Mode - Card-based splitting */
        
        
        
        /* Top view - show only first 3 cards (Sun, QTH, Band Conditions) */
        
        
        /* Bottom view - hide first 3 cards */
        
        
        /* Smooth transitions */
        
        
        /* Fullscreen adjustments */
        
        


        


        /* Kiosk Mode - Simpler approach using IDs */
        
        
        
        
        /* Top view - show Sun + QTH + Band Conditions */
        
        
        /* Bottom view - hide Sun + first 2 cards (QTH, Band) */
        
        


        /* Kiosk Mode - ID-based (bulletproof) */
        body.kiosk-mode { overflow: hidden; }
        body.kiosk-mode .container { padding: 10px !important; max-width: 100vw !important; }
        
        /* Top view - show ONLY: Sun, QTH, Band Conditions */
        body.kiosk-mode.view-top #kiosk-weather,
        body.kiosk-mode.view-top #kiosk-satellites,
        body.kiosk-mode.view-top #kiosk-dx,
        body.kiosk-mode.view-top #kiosk-system { display: none !important; }
        
        /* Bottom view - show ONLY: Weather, Satellites, DX, System */
        body.kiosk-mode.view-bottom #kiosk-sun,
        body.kiosk-mode.view-bottom #kiosk-qth,
        body.kiosk-mode.view-bottom #kiosk-bands { display: none !important; }
        
        


        
        



        /* Kiosk Bottom View - Flexbox Layout (ROBUST) */
        body.kiosk-mode.view-bottom .main-content { display: flex !important; flex-direction: column !important; }
        body.kiosk-mode.view-bottom .grid-3 { 
            display: flex !important; 
            flex-direction: row !important;
            flex-wrap: wrap !important;
            gap: 15px !important;
            width: 100% !important;
        }
        
        /* First row: 3 equal cards */
        body.kiosk-mode.view-bottom #kiosk-satellites,
        body.kiosk-mode.view-bottom #kiosk-dx,
        body.kiosk-mode.view-bottom #kiosk-system { 
            flex: 1 1 calc(33.333% - 15px) !important;
            min-width: calc(33.333% - 15px) !important;
            max-width: calc(33.333% - 15px) !important;
        }
        
        /* Second row: Weather full width */
        body.kiosk-mode.view-bottom #kiosk-weather { 
            flex: 1 1 100% !important;
            width: 100% !important;
            max-width: 100% !important;
        }

</style>
    <script src="/js/user-settings.js"></script>
    <script src="/js/band-conditions.js"></script>
    <script>
        // ============================================
        // FULL TRANSLATIONS (DE + EN)
        // ============================================
        const translations = {
            de: {
                settings_btn: '‚öôÔ∏è Einstellungen', support_btn: '‚ù§Ô∏è Support', legend_btn: '‚ÑπÔ∏è Legende',
                modal_callsign: 'Rufzeichen:', modal_locator: 'Maidenhead Locator:', modal_language: 'Sprache:',
                modal_setup_title: 'Willkommen zu OE3LCR Dashboard', modal_setup_desc: 'Willkommen! Gib deine Daten ein:',
                weather_quiet: 'Ruhig', weather_active: 'Aktiv', weather_storm: '‚ö†Ô∏è Sturm',
                card_qth: 'QTH', card_bands: 'Band Conditions', card_weather: 'Weather & Space Weather',
                card_satellites: 'Aktive Satelliten', card_dx: 'DX Cluster Spots', card_system: 'System Status',
                sunrise_sunset: '‚òÄÔ∏è Sunrise/Sunset', moonrise_set: 'Moonrise/set',
                local_weather: 'üìç LOKALES WETTER', space_weather: '‚ö° WELTRAUMWETTER',
                temp: 'üå°Ô∏è Temperatur', humidity: 'üíß Feuchtigkeit', wind: 'üí® Wind',
                kindex: 'K-Index:', solarflux: 'Solar Flux:', sunspots: 'Sunspot Number:',
                aindex: 'A-Index:', aurora: 'Aurora:', muf: 'MUF (est.):', sw_status: 'Status:',
                callsign_label: 'Callsign', locator_label: 'QTH Locator', server_label: 'Server', status_label: 'Status',
                live_metrics: '‚öôÔ∏è LIVE SYSTEM METRICS', cpu: 'üñ•Ô∏è CPU', ram: 'üß† RAM', disk: 'üíæ Disk', uptime_label: '‚è±Ô∏è Uptime:',
                sun_title: '‚òÄÔ∏è Sonne (NASA SDO - Live)', footer_updated: 'Last updated:',
                w_clear:'Klar', w_mostly_clear:'Heiter', w_partly_cloudy:'Bedeckt', w_overcast:'Bew√∂lkt', w_fog:'Neblig',
                w_light_rain:'L. Regen', w_mod_rain:'M. Regen', w_heavy_rain:'St. Regen', w_rain:'Regen',
                w_snow:'Schnee', w_heavy_snow:'St. Schnee', w_unknown:'Unbekannt',
                sat_visible: '‚úÖ Sichtbar', sat_below: '‚¨áÔ∏è Unter Horizont', sat_loading: 'Lade TLE...',
                tle_source: 'TLE Quelle:', tle_updated: 'TLE aktualisiert:',
                moon_waxing: 'zunehmend', moon_waning: 'abnehmend',
            },
            en: {
                settings_btn: '‚öôÔ∏è Settings', support_btn: '‚ù§Ô∏è Support', legend_btn: '‚ÑπÔ∏è Legend',
                modal_callsign: 'Callsign:', modal_locator: 'Maidenhead Locator:', modal_language: 'Language:',
                modal_setup_title: 'Welcome to OE3LCR Dashboard', modal_setup_desc: 'Welcome! Enter your details:',
                weather_quiet: 'Quiet', weather_active: 'Active', weather_storm: '‚ö†Ô∏è Storm',
                card_qth: 'QTH', card_bands: 'Band Conditions', card_weather: 'Weather & Space Weather',
                card_satellites: 'Active Satellites', card_dx: 'DX Cluster Spots', card_system: 'System Status',
                sunrise_sunset: '‚òÄÔ∏è Sunrise/Sunset', moonrise_set: 'Moonrise/set',
                local_weather: 'üìç LOCAL WEATHER', space_weather: '‚ö° SPACE WEATHER',
                temp: 'üå°Ô∏è Temperature', humidity: 'üíß Humidity', wind: 'üí® Wind',
                kindex: 'K-Index:', solarflux: 'Solar Flux:', sunspots: 'Sunspot Number:',
                aindex: 'A-Index:', aurora: 'Aurora:', muf: 'MUF (est.):', sw_status: 'Status:',
                callsign_label: 'Callsign', locator_label: 'QTH Locator', server_label: 'Server', status_label: 'Status',
                live_metrics: '‚öôÔ∏è LIVE SYSTEM METRICS', cpu: 'üñ•Ô∏è CPU', ram: 'üß† RAM', disk: 'üíæ Disk', uptime_label: '‚è±Ô∏è Uptime:',
                sun_title: '‚òÄÔ∏è Sun (NASA SDO - Live)', footer_updated: 'Last updated:',
                w_clear:'Clear', w_mostly_clear:'Mostly Clear', w_partly_cloudy:'Partly Cloudy', w_overcast:'Overcast', w_fog:'Foggy',
                w_light_rain:'Light Rain', w_mod_rain:'Mod. Rain', w_heavy_rain:'Heavy Rain', w_rain:'Rain',
                w_snow:'Snow', w_heavy_snow:'Heavy Snow', w_unknown:'Unknown',
                sat_visible: '‚úÖ Visible', sat_below: '‚¨áÔ∏è Below Horizon', sat_loading: 'Loading TLE...',
                tle_source: 'TLE Source:', tle_updated: 'TLE updated:',
                moon_waxing: 'waxing', moon_waning: 'waning',
            }
        };
        function t(key) {
            const lang = (typeof UserSettings!=='undefined' && UserSettings.get) ? (UserSettings.get('language')||'de') : 'de';
            return translations[lang]?.[key] || translations.de[key] || key;
        }
        function updatePageTranslations() { document.querySelectorAll('[data-i18n]').forEach(el => { el.textContent = t(el.getAttribute('data-i18n')); }); }
        function updateModalTranslations() {
            const e = (id) => document.getElementById(id);
            if (e('modal-title')) e('modal-title').textContent = t('modal_setup_title');
            if (e('welcome-text')) e('welcome-text').textContent = t('modal_setup_desc');
        }
        window.addEventListener('settingsChanged', () => { updatePageTranslations(); updateModalTranslations(); });
        document.addEventListener('DOMContentLoaded', () => { updateModalTranslations(); updatePageTranslations(); });
    </script>
</head>
<body>
    <!-- Setup Modal -->
    <div id="setup-modal"><div class="modal-content">
        <div class="modal-header">üçØ <span id="modal-title">Willkommen zu OE3LCR Dashboard</span></div>
        <div class="modal-subtitle" id="welcome-text">Willkommen! Gib deine Daten ein:</div>
        <form id="setup-form">
            <div class="form-group"><label data-i18n="modal_callsign">Rufzeichen:</label><input type="text" name="callsign" placeholder="z.B. OE3LCR" maxlength="10" required></div>
            <div class="form-group"><label data-i18n="modal_locator">Maidenhead Locator:</label><input type="text" name="locator" placeholder="z.B. JN87ct" maxlength="6" required></div>
            <div class="form-group"><label data-i18n="modal_language">Sprache:</label><select name="language" id="language-select"><option value="de">Deutsch üá©üá™</option><option value="en">English üá¨üáß</option></select></div>
            <div class="modal-buttons"><button type="submit" class="btn-primary">Start</button></div>
        </form>
    </div></div>

    <!-- QRZ Modal -->
    <div id="qrz-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); z-index:10000; align-items:center; justify-content:center;">
        <div style="background:rgba(20,20,35,0.95); border:2px solid #00ff88; border-radius:15px; padding:30px; max-width:500px; width:90%; position:relative;">
            <button onclick="closeQRZModal()" style="position:absolute; top:15px; right:15px; background:none; border:none; color:#00ff88; font-size:28px; cursor:pointer;">√ó</button>
            <div style="text-align:center; margin-bottom:20px;"><h2 id="qrz-callsign" style="color:#00ff88; font-size:2em; margin:10px 0;">N0BUI</h2><p id="qrz-frequency" style="color:#ffa502; font-size:1.1em;">14.250 MHz</p></div>
            <div style="text-align:center; margin:20px 0;"><a id="qrz-link" href="#" target="_blank" rel="noopener noreferrer" style="display:inline-block; background:linear-gradient(135deg,#00ff88,#00ff64); color:#000; padding:12px 24px; border-radius:8px; text-decoration:none; font-weight:600;">üìñ View on QRZ.com</a></div>
            <div style="text-align:center; margin-top:20px;"><button onclick="closeQRZModal()" style="background:rgba(255,100,130,0.3); border:1px solid #ff6482; color:#ff6482; padding:10px 24px; border-radius:8px; cursor:pointer; font-weight:600;">Close</button></div>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div style="display:flex; align-items:center; gap:20px;">
                <div class="callsign" id="header-callsign">üéôÔ∏è OE3LCR</div>
                <a href="support.html" style="text-decoration:none;"><button style="background:rgba(255,100,130,0.2); border:1px solid #ff6482; color:#ff6482; padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s;" data-i18n="support_btn">‚ù§Ô∏è Support</button></a>
                <a href="info.html" style="text-decoration:none;"><button style="background:rgba(0,255,136,0.2); border:1px solid #00ff88; color:#00ff88; padding:8px 16px; border-radius:8px; cursor:pointer; font-weight:600; transition:all 0.3s;" data-i18n="legend_btn">‚ÑπÔ∏è Legende</button></a>
            </div>
            <div style="display:flex; flex-direction:column; align-items:flex-end; gap:10px;">
                <div style="display:flex; gap:10px;">
                    <button id="kiosk-btn" onclick="toggleKioskMode()">üì∫ Vollbild</button>
                    <button id="settings-btn" data-i18n="settings_btn">‚öôÔ∏è Einstellungen</button>
                </div>
                <div style="display:flex; gap:30px; align-items:flex-start;">
                    <div style="text-align:right;"><div style="font-size:0.85em; color:#ff6b35; font-weight:600; margin-bottom:3px;">LOC</div><div class="time" id="time">00:00:00</div></div>
                    <div style="text-align:right;"><div style="font-size:0.85em; color:#70a1ff; font-weight:600; margin-bottom:3px;">UTC</div><div class="time" id="time-utc" style="color:#70a1ff;">00:00:00</div></div>
                </div>
                <div class="date" id="date">--.--.----</div>
            </div>
        </div>

        <div class="main-content">
            <div class="sun-display" id="kiosk-sun">
                <div style="font-size:0.9em; text-transform:uppercase; letter-spacing:2px; color:#ff4757; font-weight:600; margin-bottom:15px;" data-i18n="sun_title">‚òÄÔ∏è Sonne (NASA SDO - Live)</div>
                <div class="sun-container"><img id="sdo-image" src="https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_211193171.jpg" class="sun-image" alt="NASA SDO Live Sun Image"></div>
            </div>
            <div style="display:flex; flex-direction:column; gap:20px;">
                <div class="card" id="kiosk-qth">
                    <div class="card-header"><span class="icon">üìç</span><span class="card-title" data-i18n="card_qth">QTH</span></div>
                    <div class="location">
                        <div class="grid-square" id="qth-locator">JN87ct</div>
                        <div class="coords" id="qth-coords">47.8125¬∞N 16.2083¬∞E</div>
                        <div class="celestial-times">
                            <div class="celestial-row sun-row"><span class="celestial-label" data-i18n="sunrise_sunset">‚òÄÔ∏è Sunrise/Sunset</span><span class="celestial-times-text" id="sunTimes">07:15 / 16:45</span></div>
                            <div class="celestial-row moon-row"><span class="celestial-label"><span class="moon-phase" id="moonEmoji">üåï</span><span data-i18n="moonrise_set">Moonrise/set</span></span><span class="celestial-times-text" id="moonTimes">--:-- / --:--</span></div>
                        </div>
                    </div>
                </div>
                <div class="card" id="kiosk-bands">
                    <div class="card-header"><span class="icon">üì°</span><span class="card-title" data-i18n="card_bands">Band Conditions</span></div>
                    <div class="band-conditions-grid">
                        <div id="band160-box" class="band-box poor"><div class="band-name">160m</div><div class="band-condition">POOR</div></div>
                        <div id="band80-box" class="band-box fair"><div class="band-name">80m</div><div class="band-condition">FAIR</div></div>
                        <div id="band60-box" class="band-box good"><div class="band-name">60m</div><div class="band-condition">GOOD</div></div>
                        <div id="band40-box" class="band-box good"><div class="band-name">40m</div><div class="band-condition">GOOD</div></div>
                        <div id="band30-box" class="band-box good"><div class="band-name">30m</div><div class="band-condition">GOOD</div></div>
                        <div id="band20-box" class="band-box good"><div class="band-name">20m</div><div class="band-condition">GOOD</div></div>
                        <div id="band17-box" class="band-box good"><div class="band-name">17m</div><div class="band-condition">GOOD</div></div>
                        <div id="band15-box" class="band-box good"><div class="band-name">15m</div><div class="band-condition">GOOD</div></div>
                        <div id="band12-box" class="band-box good"><div class="band-name">12m</div><div class="band-condition">GOOD</div></div>
                        <div id="band11-box" class="band-box good"><div class="band-name">11m</div><div class="band-condition">GOOD</div></div>
                        <div id="band10-box" class="band-box good"><div class="band-name">10m</div><div class="band-condition">GOOD</div></div>
                        <div id="band6-box" class="band-box good"><div class="band-name">6m</div><div class="band-condition">GOOD</div></div>
                        <div id="band2-box" class="band-box good"><div class="band-name">2m</div><div class="band-condition">GOOD</div></div>
                    </div>
                </div>
            </div>
        </div>

        <div class="dashboard">
            <!-- Weather + Space Weather -->
            <div class="card" id="kiosk-weather" style="grid-column: 1 / -1;">
                <div class="card-header"><span class="icon">üå§Ô∏è</span><span class="card-title" data-i18n="card_weather">Weather &amp; Space Weather</span></div>
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:15px;">
                    <div style="padding:20px; background:linear-gradient(135deg, rgba(0,255,136,0.08), rgba(0,255,136,0.02)); border-left:4px solid #00ff88; border-radius:12px;">
                        <div style="color:#00ff88; font-weight:700; margin-bottom:15px; font-size:0.95em;" data-i18n="local_weather">üìç LOKALES WETTER</div>
                        <div style="font-size:3em; text-align:center; margin:15px 0;" id="localWeatherIcon">‚òÄÔ∏è</div>
                        <div style="display:grid; gap:12px;">
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="temp">üå°Ô∏è Temperatur</span><span style="color:#fff; font-weight:700;" id="localTemp">--¬∞C</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="humidity">üíß Feuchtigkeit</span><span style="color:#fff; font-weight:700;" id="localHumidity">--%</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="wind">üí® Wind</span><span style="color:#fff; font-weight:700;" id="localWind">-- km/h</span></div>
                            <div style="margin-top:10px; padding-top:10px; border-top:1px solid rgba(0,255,136,0.2); text-align:center;"><span style="color:#fff; font-weight:600;" id="localWeather">--</span></div>
                        </div>
                    </div>
                    <div style="padding:15px; background:rgba(255,165,0,0.05); border-left:3px solid #ffa502; border-radius:8px;">
                        <div style="color:#ffa502; font-weight:600; margin-bottom:12px; font-size:0.9em;" data-i18n="space_weather">‚ö° WELTRAUMWETTER</div>
                        <div style="display:grid; gap:10px;">
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="kindex">K-Index:</span><span style="color:#fff; font-weight:600;" id="kIndexCombined">--</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="solarflux">Solar Flux:</span><span style="color:#fff; font-weight:600;" id="solarFluxCombined">--</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="sunspots">Sunspot Number:</span><span style="color:#fff; font-weight:600;" id="sunspotsCombined">--</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="aindex">A-Index:</span><span style="color:#fff; font-weight:600;" id="aIndexCombined">--</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="aurora">Aurora:</span><span style="color:#fff; font-weight:600;" id="auroraCombined">Quiet</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="muf">MUF (est.):</span><span style="color:#fff; font-weight:600;" id="mufCombined">-- MHz</span></div>
                            <div style="display:flex; justify-content:space-between;"><span style="color:#aaa;" data-i18n="sw_status">Status:</span><span style="color:#fff; font-weight:600;" id="spaceWeatherCombined">--</span></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- REAL Satellites with satellite.js -->
            <div class="card">
                <div class="card-header"><span class="icon">üõ∞Ô∏è</span><span class="card-title" data-i18n="card_satellites">Aktive Satelliten</span><span class="demo-badge">LIVE</span></div>
                <div id="satellite-container" style="font-size:0.85em; line-height:1.8; max-height:350px; overflow-y:auto;"></div>
                <div style="margin-top:8px; font-size:0.7em; color:#555; text-align:center;">
                    <span data-i18n="tle_source">TLE Quelle:</span> CelesTrak ‚Ä¢ <span data-i18n="tle_updated">TLE aktualisiert:</span> <span id="tle-updated">--</span>
                </div>
            </div>

            <!-- DX Cluster -->
            <div class="card">
                <div class="card-header"><span class="icon">üåç</span><span class="card-title" data-i18n="card_dx">DX Cluster Spots</span></div>
                <div style="font-size:0.9em; line-height:1.8; max-height:300px; overflow-y:auto;">
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('N0BUI','14.250')"><strong id="dx1">N0BUI 14.250</strong> - EU<br><span style="color:#888; font-size:0.85em;" id="dx1-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('IZ0UDF','7.065')"><strong id="dx2">IZ0UDF 7.065</strong> - Asia<br><span style="color:#888; font-size:0.85em;" id="dx2-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('ZS6WX','21.290')"><strong id="dx3">ZS6WX 21.290</strong> - Africa<br><span style="color:#888; font-size:0.85em;" id="dx3-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('VK2RZA','3.525')"><strong id="dx4">VK2RZA 3.525</strong> - Oceania<br><span style="color:#888; font-size:0.85em;" id="dx4-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('JA1XYZ','10.135')"><strong id="dx5">JA1XYZ 10.135</strong> - Asia<br><span style="color:#888; font-size:0.85em;" id="dx5-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('W5XYZ','14.150')"><strong id="dx6">W5XYZ 14.150</strong> - NA<br><span style="color:#888; font-size:0.85em;" id="dx6-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; border-bottom:1px solid rgba(255,255,255,0.1); cursor:pointer;" onclick="openQRZModal('G3XYZ','7.035')"><strong id="dx7">G3XYZ 7.035</strong> - EU<br><span style="color:#888; font-size:0.85em;" id="dx7-time">--:-- UTC</span></div>
                    <div style="padding:8px; color:#ffa502; cursor:pointer;" onclick="openQRZModal('CE3XYZ','21.200')"><strong id="dx8">CE3XYZ 21.200</strong> - SA<br><span style="color:#888; font-size:0.85em;" id="dx8-time">--:-- UTC</span></div>
                </div>
            </div>

            <!-- System Status - STATIC OE3LCR -->
            <div class="card">
                <div class="card-header"><span class="icon">üíª</span><span class="card-title" data-i18n="card_system">System Status</span></div>
                <div class="info-grid">
                    <div class="info-box"><div class="info-label" data-i18n="callsign_label">Callsign</div><div class="info-value" style="color:#00ff88; font-weight:700;">OE3LCR</div></div>
                    <div class="info-box"><div class="info-label" data-i18n="locator_label">QTH Locator</div><div class="info-value" style="color:#00ff88; font-weight:700;">JN87ct</div></div>
                    <div class="info-box"><div class="info-label" data-i18n="server_label">Server</div><div class="info-value">craith.cloud</div></div>
                    <div class="info-box"><div class="info-label" data-i18n="status_label">Status</div><div class="info-value" style="color:#00ff88;">üü¢ Online</div></div>
                </div>
                <div style="margin-top:20px; padding-top:15px; border-top:1px solid rgba(0,255,136,0.2);">
                    <div style="color:#00ff88; font-weight:600; margin-bottom:12px; font-size:0.9em;" data-i18n="live_metrics">‚öôÔ∏è LIVE SYSTEM METRICS</div>
                    <div style="margin-bottom:15px;"><div style="display:flex; justify-content:space-between; margin-bottom:6px;"><span style="color:#aaa; font-size:0.9em;" data-i18n="cpu">üñ•Ô∏è CPU</span><span style="color:#fff; font-weight:600;" id="cpu-value">--</span></div><div class="metric-bar-bg" style="background:rgba(0,255,136,0.1);"><div id="cpu-bar" class="metric-bar" style="background:linear-gradient(90deg,#00ff88,#00cc6f);"></div></div></div>
                    <div style="margin-bottom:15px;"><div style="display:flex; justify-content:space-between; margin-bottom:6px;"><span style="color:#aaa; font-size:0.9em;" data-i18n="ram">üß† RAM</span><span style="color:#fff; font-weight:600;" id="ram-value">--</span></div><div class="metric-bar-bg" style="background:rgba(255,165,0,0.1);"><div id="ram-bar" class="metric-bar" style="background:linear-gradient(90deg,#ffa500,#ff8c00);"></div></div></div>
                    <div style="margin-bottom:15px;"><div style="display:flex; justify-content:space-between; margin-bottom:6px;"><span style="color:#aaa; font-size:0.9em;" data-i18n="disk">üíæ Disk</span><span style="color:#fff; font-weight:600;" id="disk-value">--</span></div><div class="metric-bar-bg" style="background:rgba(100,100,255,0.1);"><div id="disk-bar" class="metric-bar" style="background:linear-gradient(90deg,#6464ff,#5555dd);"></div></div></div>
                    <div style="padding:10px; background:rgba(0,150,200,0.1); border-radius:6px;"><span style="color:#aaa; font-size:0.85em;" data-i18n="uptime_label">‚è±Ô∏è Uptime:</span> <span style="color:#fff; font-weight:600;" id="uptime-value">--</span></div>
                </div>
            </div>
        </div>

        <div class="footer"><p>üçØ Powered by Gwen ‚Ä¢ OE3LCR Dashboard ‚Ä¢ <span data-i18n="footer_updated">Last updated:</span> <span id="footer-time">--:--:--</span></p></div>
    </div>

    <script>
    // ============================================
    // MAIN APPLICATION v4
    // ============================================
    const TIMEZONE = 'Europe/Vienna';
    const MOON_EMOJIS = ['üåë','üåí','üåì','üåî','üåï','üåñ','üåó','üåò'];
    const $ = (id) => document.getElementById(id);

    // === TIMEZONE ===
    function getViennaTime(now) { return new Intl.DateTimeFormat('de-AT',{timeZone:TIMEZONE,hour:'2-digit',minute:'2-digit',second:'2-digit',hour12:false}).format(now); }
    function getViennaDate(now) { return new Intl.DateTimeFormat('de-AT',{timeZone:TIMEZONE,weekday:'long',year:'numeric',month:'2-digit',day:'2-digit'}).format(now); }

    function getMoonPhase(d) { return Math.round((((((d-new Date(2026,0,29))/864e5)%29.53)+29.53)%29.53)/29.53*8)%8; }
    function getMoonRiseSet(d) {
        const p=getMoonPhase(d), h=(6+p*3)%24, s=(h+12)%24, v=(d.getDate()*50)%60;
        return {rise:String(h).padStart(2,'0')+':'+String(v).padStart(2,'0'), set:String(s).padStart(2,'0')+':'+String((v+30)%60).padStart(2,'0')};
    }

    function updateTime() {
        const now=new Date();
        if($('time'))$('time').textContent=getViennaTime(now);
        if($('time-utc'))$('time-utc').textContent=[now.getUTCHours(),now.getUTCMinutes(),now.getUTCSeconds()].map(v=>String(v).padStart(2,'0')).join(':');
        if($('date'))$('date').textContent=getViennaDate(now);
        if($('footer-time'))$('footer-time').textContent=getViennaTime(now);
        if($('moonEmoji'))$('moonEmoji').textContent=MOON_EMOJIS[getMoonPhase(now)];
        const m=getMoonRiseSet(now);
        if($('moonTimes'))$('moonTimes').textContent=`${m.rise} / ${m.set}`;
    }

    // === SOLAR DATA (parallel load) ===
    let realSolarData = null;
    const solarP = fetch('/data/solar-data.json?t='+Date.now()).then(r=>r.ok?r.json():null).then(d=>{realSolarData=d;}).catch(()=>{});

    function estimateMUF(sfi) { return Math.max(10,Math.round((Math.sqrt(sfi)*2.5+Math.sin((new Date().getUTCHours()-6)*Math.PI/12)*3)*10)/10); }

    function updateSolarData() {
        let sfi=95,ssn=63,kI=2,aI=24;
        if(realSolarData?.success){kI=realSolarData.kIndex||2;sfi=realSolarData.sfi||95;if(window.updateAllBandConditions)updateAllBandConditions();aI=realSolarData.aIndex||kI*12;ssn=Math.round(sfi/1.5);}
        let st=t('weather_quiet'); if(kI>5)st=t('weather_active'); if(kI>7)st=t('weather_storm');
        const u={kIndexCombined:kI,solarFluxCombined:sfi,sunspotsCombined:ssn,aIndexCombined:aI,auroraCombined:kI>4?'Visible':'Quiet',mufCombined:estimateMUF(sfi)+' MHz',spaceWeatherCombined:st};
        for(const[id,v]of Object.entries(u)){if($(id))$(id).textContent=v;}
        
    }

    // === REAL SATELLITE TRACKING with satellite.js ===
    let satRecords = {}; // {name: {satrec, color}}
    let tleData = null;

    async function loadTLEData() {
        try {
            const r = await fetch('/satellite-data.json?t='+Date.now());
            tleData = await r.json();
            if ($('tle-updated')) $('tle-updated').textContent = tleData.updated_at || '--';
            const sats = tleData.satellites;
            for (const [name, data] of Object.entries(sats)) {
                try {
                    const satrec = satellite.twoline2satrec(data.tle1, data.tle2);
                    satRecords[name] = { satrec, color: data.color || '#fff' };
                } catch(e) {}
            }
            updateSatellites();
        } catch(e) {
            if ($('satellite-container')) $('satellite-container').innerHTML = '<div style="color:#ff4757; padding:10px;">TLE data unavailable</div>';
        }
    }

    function updateSatellites() {
        const container = $('satellite-container');
        if (!container) return;

        // Observer position from TLE data (OE3LCR QTH)
        const obsLat = 47.8125 * Math.PI / 180;
        const obsLon = 16.2083 * Math.PI / 180;
        const obsAlt = 0.2; // km

        const now = new Date();
        const gmst = satellite.gstime(now);
        let html = '';

        for (const [name, {satrec, color}] of Object.entries(satRecords)) {
            try {
                const posVel = satellite.propagate(satrec, now);
                if (!posVel.position) { html += `<div style="padding:8px; color:${color}; border-bottom:1px solid rgba(255,255,255,0.1);"><strong>${name}</strong><div style="color:#ff4757; font-size:0.8em;">Propagation error</div></div>`; continue; }

                const eciPos = posVel.position;
                const ecfPos = satellite.eciToEcf(eciPos, gmst);
                const lookAngles = satellite.ecfToLookAngles({latitude:obsLat, longitude:obsLon, height:obsAlt}, ecfPos);

                const azDeg = lookAngles.azimuth * 180 / Math.PI;
                const elDeg = lookAngles.elevation * 180 / Math.PI;
                const distKm = lookAngles.rangeSat;

                const isVisible = elDeg > 0;
                const statusText = isVisible ? t('sat_visible') : t('sat_below');
                const elColor = isVisible ? '#00ff88' : '#666';

                html += `<div style="padding:8px; color:${color}; border-bottom:1px solid rgba(255,255,255,0.1);">` +
                    `<div><strong>${name}</strong></div>` +
                    `<div style="color:#aaa; font-size:0.8em; font-variant-numeric:tabular-nums;">Az: ${azDeg.toFixed(1).padStart(5)}¬∞ El: <span style="color:${elColor}">${elDeg.toFixed(1).padStart(5)}¬∞</span> Dist: ${Math.round(distKm)} km</div>` +
                    `<div style="color:${isVisible?'#00ff88':'#666'}; font-size:0.75em; margin-top:2px;">${statusText}</div>` +
                    `</div>`;
            } catch(e) {
                html += `<div style="padding:8px; color:${color}; border-bottom:1px solid rgba(255,255,255,0.1);"><strong>${name}</strong><div style="color:#ff4757; font-size:0.8em;">Calc error</div></div>`;
            }
        }

        container.innerHTML = html || `<div style="color:#888; padding:10px;">${t('sat_loading')}</div>`;
    }

    // === DX CLUSTER ===
    function updateDXCluster() {
        const calls=['N0BUI','IZ0UDF','ZS6WX','VK2RZA','JA1XYZ','W5XYZ','G3XYZ','CE3XYZ'];
        const freqs=['3.525','7.035','7.065','10.135','14.150','14.250','21.200','21.290'];
        const now=new Date();
        for(let i=1;i<=8;i++){
            const ci=Math.floor(Math.random()*calls.length),fi=Math.floor(Math.random()*freqs.length);
            const st=new Date(now.getTime()-(2+Math.floor(Math.random()*5))*60000);
            if($(`dx${i}`))$(`dx${i}`).textContent=`${calls[ci]} ${freqs[fi]}`;
            if($(`dx${i}-time`))$(`dx${i}-time`).textContent=String(st.getUTCHours()).padStart(2,'0')+':'+String(st.getUTCMinutes()).padStart(2,'0')+' UTC';
        }
    }

    // === LOCATOR ===
    function locatorToCoords(loc) {
        if(!loc||loc.length<4)return{lat:47.8125,lon:16.2083,display:'47.8125¬∞N 16.2083¬∞E'};
        loc=loc.toUpperCase();
        try{let lo=(loc.charCodeAt(0)-65)*20-180,la=(loc.charCodeAt(1)-65)*10-90;if(loc.length>=4){lo+=parseInt(loc[2])*2;la+=parseInt(loc[3]);}if(loc.length>=6){lo+=(loc.charCodeAt(4)-65)*(2/24)+(1/24);la+=(loc.charCodeAt(5)-65)*(1/24)+(1/48);}lo=Math.max(-180,Math.min(180,lo));la=Math.max(-90,Math.min(90,la));return{lat:la,lon:lo,display:`${Math.abs(la).toFixed(4)}¬∞${la>=0?'N':'S'} ${Math.abs(lo).toFixed(4)}¬∞${lo>=0?'E':'W'}`};}
        catch(e){return{lat:47.8125,lon:16.2083,display:'47.8125¬∞N 16.2083¬∞E'};}
    }
    function formatLocator(l){if(!l)return'JN87ct';l=l.toUpperCase();return l.length===6?l.substring(0,4)+l.substring(4,6).toLowerCase():l;}

    // === PERSONALIZATION ===
    function personalizeHomepage() {
        const s=UserSettings.load(), call=(s.callsign||'OE3LCR').toUpperCase(), loc=formatLocator(s.locator||'JN87ct');
        if($('header-callsign'))$('header-callsign').textContent=`üéôÔ∏è ${call}`;
        if($('qth-locator'))$('qth-locator').textContent=loc;
        if($('qth-coords'))$('qth-coords').textContent=locatorToCoords(loc).display;
        document.title=`${call} - Ham Radio Dashboard`;
    }
    window.addEventListener('settingsChanged',()=>{personalizeHomepage();fetchLocalWeather();updatePageTranslations();updateSatellites();});
    window.addEventListener('storage',(e)=>{if(e.key==='gwen_hp_settings')personalizeHomepage();});

    // === WEATHER ===
    async function fetchLocalWeather() {
        try{const c=locatorToCoords(UserSettings.load().locator||'JN87ct'),r=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${c.lat}&longitude=${c.lon}&current=temperature_2m,relative_humidity_2m,weather_code,wind_speed_10m,is_day&timezone=auto`);if(!r.ok)throw 0;const d=await r.json(),v=d.current;if(!v)throw 0;const isDay=v.is_day===1;
        const wC={0:{d:'‚òÄÔ∏è',n:'üåô',k:'w_clear'},1:{d:'üå§Ô∏è',n:'üåô',k:'w_mostly_clear'},2:{d:'‚õÖ',n:'‚òÅÔ∏è',k:'w_partly_cloudy'},3:{d:'‚òÅÔ∏è',n:'‚òÅÔ∏è',k:'w_overcast'},45:{d:'üå´Ô∏è',n:'üå´Ô∏è',k:'w_fog'},48:{d:'üå´Ô∏è',n:'üå´Ô∏è',k:'w_fog'},51:{d:'üå¶Ô∏è',n:'üåßÔ∏è',k:'w_light_rain'},53:{d:'üåßÔ∏è',n:'üåßÔ∏è',k:'w_mod_rain'},55:{d:'‚õàÔ∏è',n:'‚õàÔ∏è',k:'w_heavy_rain'},61:{d:'üåßÔ∏è',n:'üåßÔ∏è',k:'w_rain'},63:{d:'üåßÔ∏è',n:'üåßÔ∏è',k:'w_mod_rain'},65:{d:'‚õàÔ∏è',n:'‚õàÔ∏è',k:'w_heavy_rain'},71:{d:'üå®Ô∏è',n:'üå®Ô∏è',k:'w_snow'},73:{d:'üå®Ô∏è',n:'üå®Ô∏è',k:'w_snow'},75:{d:'üå®Ô∏è',n:'üå®Ô∏è',k:'w_heavy_snow'},80:{d:'üåßÔ∏è',n:'üåßÔ∏è',k:'w_rain'},81:{d:'üåßÔ∏è',n:'üåßÔ∏è',k:'w_rain'},82:{d:'‚õàÔ∏è',n:'‚õàÔ∏è',k:'w_heavy_rain'},85:{d:'üå®Ô∏è',n:'üå®Ô∏è',k:'w_snow'},86:{d:'üå®Ô∏è',n:'üå®Ô∏è',k:'w_heavy_snow'}};
        const w=wC[v.weather_code]||{d:'‚ùì',n:'‚ùì',k:'w_unknown'},icon=isDay?w.d:(v.weather_code<=3?(()=>{const p=getMoonPhase(new Date()),e=MOON_EMOJIS[p],ph=p<4?t('moon_waxing'):t('moon_waning');return e+' '+ph;})():w.n);
        if($('localTemp'))$('localTemp').textContent=`${v.temperature_2m}¬∞C`;if($('localHumidity'))$('localHumidity').textContent=`${v.relative_humidity_2m}%`;if($('localWind'))$('localWind').textContent=`${Math.round(v.wind_speed_10m)} km/h`;if($('localWeatherIcon'))$('localWeatherIcon').textContent=icon;if($('localWeather'))$('localWeather').innerHTML=`${icon} ${t(w.k)}`;
        }catch(e){if($('localTemp'))$('localTemp').textContent='--¬∞C';if($('localWeather'))$('localWeather').textContent='‚ùå API Error';if($('localWeatherIcon'))$('localWeatherIcon').textContent='‚ùì';}
    }

    // === QRZ ===
    function openQRZModal(cs,f){$('qrz-callsign').textContent=cs;$('qrz-frequency').textContent=f+' MHz';$('qrz-link').href=`https://www.qrz.com/lookup/${encodeURIComponent(cs)}`;$('qrz-modal').style.display='flex';}
    function closeQRZModal(){$('qrz-modal').style.display='none';}
    document.addEventListener('click',(e)=>{if(e.target===$('qrz-modal'))closeQRZModal();});

    // === SYSTEM STATS ===
    async function loadSystemStats(){try{const d=await(await fetch('/get-system-stats.php')).json();if($('cpu-value')){$('cpu-value').textContent=d.cpu_percent+'%';$('cpu-bar').style.width=d.cpu_percent+'%';}if($('ram-value')){$('ram-value').textContent=d.ram_percent+'%';$('ram-bar').style.width=d.ram_percent+'%';}if($('disk-value')){$('disk-value').textContent=d.disk_percent+'%';$('disk-bar').style.width=d.disk_percent+'%';}if($('uptime-value'))$('uptime-value').textContent=d.uptime;}catch(e){}}

    function refreshSDOImage(){if($('sdo-image'))$('sdo-image').src='https://sdo.gsfc.nasa.gov/assets/img/latest/latest_1024_211193171.jpg?t='+Date.now();}

    // === INIT ===
    async function init(){
        personalizeHomepage(); updateTime();
        await solarP; updateSolarData(); if(window.updateAllBandConditions)updateAllBandConditions();
        fetchLocalWeather(); updateDXCluster(); refreshSDOImage(); loadSystemStats(); loadTLEData(); updatePageTranslations();
    }
    if(document.readyState==='loading'){document.addEventListener('DOMContentLoaded',init);}else{init();}

    setInterval(updateTime,1000);
    setInterval(()=>{fetch('/data/solar-data.json?t='+Date.now()).then(r=>r.json()).then(d=>{realSolarData=d;updateSolarData();}).catch(()=>{});},300000);
    setInterval(fetchLocalWeather,600000);
    setInterval(updateDXCluster,60000);
    setInterval(updateSatellites,7000); // Real tracking: every 5 sec
    setInterval(refreshSDOImage,300000);
    setInterval(loadSystemStats,10000);
    setInterval(loadTLEData,3600000); // Reload TLE every hour
    </script>

<script>
// Kiosk Mode with Auto-Rotate
let kioskMode=false,currentView='top',rotateInterval=null;
function loadKioskState(){const s=localStorage.getItem('kioskMode');if(s==='true')enableKioskMode();}
function saveKioskState(e){localStorage.setItem('kioskMode',e?'true':'false');}
function enableKioskMode(){if(kioskMode)return;kioskMode=true;saveKioskState(true);const e=document.documentElement;if(e.requestFullscreen)e.requestFullscreen();else if(e.webkitRequestFullscreen)e.webkitRequestFullscreen();document.body.classList.add('kiosk-mode');startAutoRotate();showView('top');}
function disableKioskMode(){if(!kioskMode)return;kioskMode=false;saveKioskState(false);if(document.exitFullscreen)document.exitFullscreen();else if(document.webkitExitFullscreen)document.webkitExitFullscreen();document.body.classList.remove('kiosk-mode','view-top','view-bottom');stopAutoRotate();}
function toggleKioskMode(){kioskMode?disableKioskMode():enableKioskMode();}
function showView(v){currentView=v;document.body.classList.remove('view-top','view-bottom');document.body.classList.add('view-'+v);}
function startAutoRotate(){stopAutoRotate();rotateInterval=setInterval(()=>{currentView=currentView==='top'?'bottom':'top';showView(currentView);},7000);}
function stopAutoRotate(){if(rotateInterval){clearInterval(rotateInterval);rotateInterval=null;}}
document.addEventListener('keydown',e=>{if(e.key==='Escape'&&kioskMode)disableKioskMode();});
document.addEventListener('fullscreenchange',()=>{if(!document.fullscreenElement&&kioskMode)disableKioskMode();});
window.addEventListener('DOMContentLoaded',()=>{loadKioskState();});
</script>

</body>
</html>
